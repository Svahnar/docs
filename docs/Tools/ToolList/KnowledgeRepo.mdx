import Video from '@site/src/components/Video';
import { Steps, Step } from '@site/src/components/Steps/Steps';

# KnowledgeRepo

Empower your agents with **semantic search** capabilities over your custom knowledge base.

This guide will walk you through configuring the Knowledge Repository tool to enable Retrieval-Augmented Generation (RAG) using Qdrant and OpenAI.

## üí° Core Concepts

To configure this tool, you need to understand how the search and scoping work.

### 1. How does this Tool work?

The **KnowledgeRepo** tool performs a semantic search. It takes a natural language query from your agent, converts it into a vector using OpenAI embeddings, and queries your Qdrant database to find the most relevant text snippets.

### 2. Search Scoping (Filtering)

You can restrict the search to specific data subsets using IDs:

* **Knowledge Repo ID (`k_repo_id`):** Restricts search to a specific repository UUID.
* **Document ID (`doc_id`):** Restricts search to a specific document UUID within a repository.

:::info Access Control
The tool automatically enforces permission checks. If a `k_repo_id` is provided, the tool verifies that the current user (the creator of the agent) has permission to access that specific repository.
:::

---

## ‚öôÔ∏è Configuration Steps

Follow these steps to integrate the Knowledge Repository tool.

<Steps>
<Step>

### Prepare Credentials

Ensure you have the following credentials ready:

1. **Qdrant URL & API Key:** Points to your Qdrant vector database instance.
2. **OpenAI API Key:** Used to generate embeddings for the search query.
3. **Collection Name:** The exact name of the collection in Qdrant you want to search.

</Step>

<Step>

### Configure Tool in Agent

Add the `KnowledgeRepo` tool to your agent's configuration. You must map the credentials to the `config` block.

**Required Configuration Parameters:**

* `QDRANT_COLLECTION_NAME`
* `QDRANT_URL`
* `KR_API_KEY`
* `OPENAI_API_KEY`

:::tip Environment Variables
We strongly recommend using `${VARIABLE_NAME}` syntax to reference environment variables rather than hardcoding sensitive keys in your YAML.
:::

</Step>

<Step>

### define Agent Function

Instruct your agent on *when* to use this tool.

* **Example Instruction:** "If the user asks about internal policies, use the KnowledgeRepo tool to find the answer."
* **Query Input:** The agent will automatically generate the `query` string based on the user's conversation.
</Step>

</Steps>

---

## üìö Practical Recipes (Examples)

### Recipe 1: Basic Global Search

> **Use Case:** An agent that searches the entire vector database collection without restriction.

```yaml showLineNumbers
create_vertical_agent_network:
  agent-1:
    agent_name: researcher_agent
    LLM_config:
      params:
        model: gpt-5-mini
    tools:
      tool_assigned:
        - name: KnowledgeRepo
          config:
            QDRANT_COLLECTION_NAME: "company_knowledge_base"
            QDRANT_URL: "https://your-qdrant-instance.com"
            KR_API_KEY: "${KR_API_KEY}"
            OPENAI_API_KEY: "${OPENAI_API_KEY}"
            # Optional: Specify embedding model (default: text-embedding-3-small)
            EMBEDDING_MODEL: "text-embedding-3-large"
    agent_function:
      - "Search the knowledge repository for relevant passages and answer the user's question."
    incoming_edge:
      - Start
    outgoing_edge: []

```

### Recipe 2: Scoped Search (Specific Repository)

> **Use Case:** An agent restricted to searching a specific Knowledge Repository (e.g., "HR Policies" only).

```yaml showLineNumbers
create_vertical_agent_network:
  agent-1:
    agent_name: hr_policy_bot
    LLM_config:
      params:
        model: gpt-5-mini
    tools:
      tool_assigned:
        - name: KnowledgeRepo
          config:
            QDRANT_COLLECTION_NAME: "global_docs"
            QDRANT_URL: "https://your-qdrant-instance.com"
            KR_API_KEY: "${KR_API_KEY}"
            OPENAI_API_KEY: "${OPENAI_API_KEY}"
            # Hardcode the Repo ID to restrict search scope
            k_repo_id: "550e8400-e29b-41d4-a716-446655440000"
    agent_function:
      - "You are an HR assistant. Use the KnowledgeRepo tool to answer policy questions."
    incoming_edge:
      - Start
    outgoing_edge: []

```

---

## üöë Troubleshooting

* **"Invalid Knowledge Repository ID" Error**
* Ensure the `k_repo_id` provided is a valid UUID format.
* Check if the variable type in your config is a string.


* **"You do not have permission to access..."**
* This occurs if the `k_repo_id` exists but belongs to a different user/organization, and is not marked as `is_global`.
* Verify the ownership of the Knowledge Repository you are trying to access.


* **Empty Results / Poor Relevance**
* Check if `EMBEDDING_MODEL` matches the model used to index your data in Qdrant.
* Ensure the `QDRANT_COLLECTION_NAME` is correct.
* Verify that `OPENAI_API_KEY` is active and has quota.